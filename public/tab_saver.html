<html>
<head>
   
</head>
<body>
    <div style="background-color: blanchedalmond;padding: 4px;">
        <h4>Gather tabs using the plugin, then send them to be saved and organized by
        clickingon "Save Tabs"</h4>
        <button onclick="save_tabs()">Save Tabs</button>
        <input id="all_tabs" type="hidden" value="" >
        <label for="uemail" >Email is required:</label><input type="email" value="" id="uemail" name="uemail" />
    </div>
    <div>
        <h4>Info follows</h4> 
        <ul id="tab_list">
            
        </ul>
    </div>
</body>
</html>
<script>


//
async function postData(url = '', data = {}, creds = 'omit', do_stringify = true, ctype) {
    let content_type = 'application/json'
    if ( ctype !== undefined ) {
        content_type = ctype
    }
    let options = {
        method: 'POST', // *GET, POST, PUT, DELETE, etc.
        mode: 'cors', // no-cors, *cors, same-origin
        cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
        credentials: creds, // include, *same-origin, omit
        headers: {
            'Content-Type': content_type
        },
        redirect: 'follow', // manual, *follow, error
        referrerPolicy: 'no-referrer', // no-referrer, *client
        body: (do_stringify ? JSON.stringify(data)  : data)	// body data type must match "Content-Type" header
    }

    if ( ctype === 'multipart/form-data') {
        delete options.headers['Content-Type']  // content type will be set automatically with a boundary
    }

    // Default options are marked with *
    const response = await fetch(url, options);
    if ( response.ok == false ) {
        console.log(response.status + ': ' + response.statusText)
        return {}
    } else {
        return await response.json(); // parses JSON response into native JavaScript objects
    }
}


async function save_tabs() {
    let data_deposit = document.getElementById('all_tabs')
    let tab_info = data_deposit.value

    if ( tab_info !== undefined && tab_info.length ) {
        try {
            let tabs_to_send = JSON.parse(tab_info)
            let email_in = document.getElementById('uemail')
            if ( email_in ) {
                let email = email_in.value
                if ( email.length ) {
                    let postable = {
                        "email" : email,
                        "tabs" : tabs_to_send
                    }
                    let response = await postData("/put_tabs",postable)
                    if ( response.status === "OK" ) {
                        
                    }
                    return
                } else {
                    alert("your account email is required")
                }
            }
        } catch(e) {
            alert(e)
        }
    }

    alert("could not send data")

}
   
</script>
